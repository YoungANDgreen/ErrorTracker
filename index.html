<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Reporting</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        #barcodeScanner {
            display: none;
            margin-top: 20px;
        }

        video {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Error Reporting Form</h1>
    <form id="errorForm">
        <label for="orderNumber">Order Number:</label>
        <input type="text" id="orderNumber" name="orderNumber" required>
        <button type="button" id="scanBarcodeButton">Scan Barcode</button>
        <br><br>

        <div id="barcodeScanner">
            <div id="scanner-container"></div>
            <button type="button" id="stopScanButton">Stop Scanning</button>
        </div>

        <label for="notes">Notes:</label>
        <textarea id="notes" name="notes" rows="4" cols="50" placeholder="Describe the issue here..."></textarea>
        <br><br>

        <label>Additional Options:</label><br>
        <input type="checkbox" id="callRequest" name="callRequest">
        <label for="callRequest">Would like salesperson to call</label><br>
        <input type="checkbox" id="sendASAP" name="sendASAP">
        <label for="sendASAP">Send ASAP</label><br>
        <br>

        <button type="submit">Submit</button>
    </form>

    <script>
        const scanBarcodeButton = document.getElementById("scanBarcodeButton");
        const stopScanButton = document.getElementById("stopScanButton");
        const barcodeScanner = document.getElementById("barcodeScanner");
        const orderNumberInput = document.getElementById("orderNumber");

        let isScanning = false;

        scanBarcodeButton.addEventListener("click", () => {
            if (!isScanning) {
                startScanning();
                barcodeScanner.style.display = "block";
                isScanning = true;
            }
        });

        stopScanButton.addEventListener("click", stopScanning);

        function startScanning() {
            Quagga.init(
                {
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: document.getElementById("scanner-container"), // ID of the container for video preview
                        constraints: {
                            width: 640,
                            height: 480,
                            facingMode: "environment", // Use the back camera
                        },
                    },
                    decoder: {
                        readers: ["code_128_reader"], // Specify the barcode format
                    },
                },
                function (err) {
                    if (err) {
                        console.error("Quagga initialization error:", err);
                        return;
                    }
                    Quagga.start();
                    console.log("Quagga started.");
                }
            );

            // Process detected barcodes
            Quagga.onDetected((result) => {
                if (result && result.codeResult && result.codeResult.code) {
                    const scannedCode = result.codeResult.code;
                    console.log("Scanned Code:", scannedCode);

                    // Populate the input field with the scanned code
                    orderNumberInput.value = scannedCode;

                    // Stop scanning after successful detection
                    stopScanning();
                    alert(`Scanned Order Number: ${scannedCode}`);
                }
            });
        }

        function stopScanning() {
            if (isScanning) {
                Quagga.stop();
                barcodeScanner.style.display = "none";
                isScanning = false;
                console.log("Quagga stopped.");
            }
        }
    </script>
</body>
</html>
