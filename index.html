<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Reporting</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        #barcodeScanner {
            display: none;
            position: relative;
            margin-top: 20px;
        }

        #scanner-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            background-color: black;
        }

        video {
            width: 100%;
            height: auto;
        }

        #overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 30%;
            border: 2px solid red;
            transform: translate(-50%, -50%);
            box-sizing: border-box;
        }

        .feedback {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Error Reporting Form</h1>
    <form id="errorForm">
        <label for="orderNumber">Order Number:</label>
        <input type="text" id="orderNumber" name="orderNumber" required>
        <button type="button" id="scanBarcodeButton">Scan Barcode</button>
        <br><br>

        <div id="barcodeScanner">
            <div id="scanner-container">
                <div id="overlay"></div>
                <div class="feedback" id="feedback">Align barcode within the red rectangle</div>
            </div>
            <button type="button" id="stopScanButton">Stop Scanning</button>
        </div>
    </form>

    <script>
        const scanBarcodeButton = document.getElementById("scanBarcodeButton");
        const stopScanButton = document.getElementById("stopScanButton");
        const barcodeScanner = document.getElementById("barcodeScanner");
        const orderNumberInput = document.getElementById("orderNumber");

        let isScanning = false;

        scanBarcodeButton.addEventListener("click", () => {
            if (!isScanning) {
                startScanning();
                barcodeScanner.style.display = "block";
                isScanning = true;
            }
        });

        stopScanButton.addEventListener("click", stopScanning);

        function startScanning() {
            Quagga.init(
                {
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: document.getElementById("scanner-container"),
                        constraints: {
                            width: 640,
                            height: 480,
                            facingMode: "environment",
                        },
                    },
                    decoder: {
                        readers: ["code_128_reader"],
                    },
                    locate: true, // Locate barcode position
                    locator: {
                        patchSize: "medium",
                        halfSample: true,
                    },
                },
                function (err) {
                    if (err) {
                        console.error("Quagga initialization error:", err);
                        return;
                    }
                    Quagga.start();
                    console.log("Quagga started.");
                }
            );

            Quagga.onDetected((result) => {
                if (result && result.codeResult && result.codeResult.code) {
                    const scannedCode = result.codeResult.code;
                    console.log("Scanned Code:", scannedCode);

                    // Populate the input field with the scanned code
                    orderNumberInput.value = scannedCode;

                    // Stop scanning after successful detection
                    stopScanning();
                    alert(`Scanned Order Number: ${scannedCode}`);
                }
            });

            Quagga.onProcessed((result) => {
                const drawingCtx = Quagga.canvas.ctx.overlay;
                const drawingCanvas = Quagga.canvas.dom.overlay;

                if (result) {
                    drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);

                    if (result.boxes) {
                        result.boxes
                            .filter((box) => box !== result.box)
                            .forEach((box) => {
                                Quagga.ImageDebug.drawPath(box, { x: 0, y: 1 }, drawingCtx, {
                                    color: "blue",
                                    lineWidth: 2,
                                });
                            });
                    }

                    if (result.box) {
                        Quagga.ImageDebug.drawPath(result.box, { x: 0, y: 1 }, drawingCtx, {
                            color: "green",
                            lineWidth: 2,
                        });
                    }
                }
            });
        }

        function stopScanning() {
            if (isScanning) {
                Quagga.stop();
                barcodeScanner.style.display = "none";
                isScanning = false;
                console.log("Quagga stopped.");
            }
        }
    </script>
</body>
</html>



